---
layout: post
title: "chapter7 LCLSS"
description: ""
category: LCLSS
tags: [LCLSS, 学习, command line, linux]
---
{% include JB/setup %}

# 第7章 管理文件系统

## 7.1 探索Linux文件系统

Linux支持多种类型的文件系统来管理文件和目录

### 7.1.1 基本的Linux文件系统

#### 1. ext文件系统

扩展文件系统(extended filesystem, ext)

使用虚拟目录来操作硬件设备,在物理设备上按定长的块来存储数据

ext文件系统采用**索引节点**来存放虚拟目录中所存储文件的信息

索引节点系统在每个物理设备中创建一个单独的表(索引节点表)来存储这些文件的信息.存储在虚拟目录中的每一个文件在索引节点表中都有一个条目.条目名称的扩展部分来自其跟踪每个文件的课外数据,包括:

* 文件名
* 文件大小
* 文件的属主
* 文件的属组
* 文件的访问权限
* 指向存有文件数据的每个硬盘块的指针

Linux通过唯一的数值(索引节点号)来引用索引节点表中的每个索引节点,这个值在创建时由文件系统分配,文件系统通过索引节点号而不是文件全名及路径来标识文件

#### 2. ext2文件系统

ext文件大小不能超过2GB,ext升级到第二扩展文件系统,ext2

ext2是ext基本功能的一个扩展, 扩展了索引节点表的格式来保存系统上每个文件的更多信息

添加了创建时间值,修改时间值,最后访问时间值来帮助系统管理员追踪文件的访问情况,最大文件大小增加到2TB(后期版本增加到32TB)

ext2还改变了文件在数据块中存储的方式. ext文件系统常见的问题是在文件写入物理设备时,存储数据用的块很容易就分散在整个设备上(碎片化),降低文件系统的性能. ext2通过按组分配磁盘块来减轻碎片化,通过数据块分组,文件系统就不需要为了数据块查找整个物理设备来读取文件


ext文件系统脆弱,每次存储或更新文件,要用新信息来更新索引节点表,但是并不是连成一气的,在存储文件和更新索引节点表的过程中,计算机系统发生了什么事情,这二者就不同步了

### 7.1.2 日志文件系统

取代了先将数据直接写入存储设备再更新索引节点表的作法

日志文件系统会先将文件的更改写入临时文件(日志,journal)中,然后在数据成功写到存储设备和索引节点表之后,再删除对应的日志条目.

如果系统在数据被写入到存储设备之前崩溃了或断电了,日志文件系统下次会读取日志文件并处理上次留下的未写入的数据

3种日志 方法

* 数据模式
* 排序模式
* 回写模式

### 7.1.3 扩展的Linux日志文件系统

与ext2文件系统兼容,并且可以转换

#### 1 ext3 文件系统

采用和ext2文件系统相同的索引节点结构,但是给每个设备增加了一个日志文件


默认使用排序模式

ext3 仍然缺一些东西,比如无法恢复误删的文件,没有内建的数据压缩功能,也不支持加密文件

#### 2 ext4 文件系统

除了支持数据压缩和加密,ext4还支持一个称作**区段(extent)**的特性. 区段在存储设备上按块分配空间, 但在索引节点表总只保存起始块的位置,无需列出所有用来存储文件中数据的数据块,可以在索引节点表中节省一些空间

ext4 还整合了**块预分配(block preallocation)** ,如果你想在存储上给一个你知道要变大的文件预留空间,通过ext4文件系统你可以为文件分配所有期望的块,不只是物理上存在的块,ext4文件系统用0填满预留的数据块,并知道不要将它们分配给其他文件

如何加密,压缩,恢复, 我比较好奇


#### 3 Reiser文件系统

ReiserFS, 只支持回写日志模式, Linux上最快的日志文件系统之一.

* 可以在线调整已有文件系统的大小.
* 尾部压缩(tail packing)技术, 可以将一个文件的数据填进另一个文件的数据块中的空白空间

