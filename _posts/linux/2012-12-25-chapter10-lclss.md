---
layout: post
title: "构建基本脚本 chapter10 LCLSS"
description: ""
category: LCLSS
tags: [linux, command line, 学习, LCLSS]
---
{% include JB/setup %}

# 第10章构建基本脚本

## 10.1 使用多个命令

两个命令一起运行,用`;`分隔

但是每行不能超过255个字符

## 10.2 创建shell脚本文件

文件第一行指定要使用的shell

    #!/bin/bash
	
`#`用作注释行,shell中的注释行是不被shell执行的,然而第一行是一个特例,`#`后的`!`告诉shell用哪个shell来运行脚本

要让shell找到脚本

* 将shell脚本文件所处的目录添加到PATH环境变量中
* 在提示符中用绝对或相对文件路径来引用文件

还有权限问题,`chmod`给脚本增加可执行权限

## 10.3 显示消息

`echo` 命令来显示消息

一般不用用`'`或`"`圈起来,但是当字符串中有这个两个符号时,要用另一个把字符串圈起来

`-n` 参数使得下一行命令的输出紧接着字符串结束的地方

## 10.4 使用变量

### 10.4.1 环境变量

`set` 显示环境变量(局部和全局的)

在环境变量名称之前加`$`来使用这些环境变量

    echo UID: $UID
	
	echo "User info for userid: $USER"
	
在`"`内也可以使用,要显示`&`符号使用`\`转义

但是`'`内会照原样输出

可以通过`${变量}`的方式来引用变量

### 10.4.2 用户变量

大小写敏感

值通过等号来赋值给变量,变量,等号,值之间不出现空格.

在脚本的整个生命周期力,shell脚本中定义的变量会一直保持他们的值,但是shell脚本完成时删除掉

用`$`符号引用变量

### 10.4.3 反应号

shell脚本中最有用的就是`` ` ``

反引号允许你将shell命令的输出赋值给变量

    testing=`date`
	
一个典型的例子

    today=`date +%y%m%d`
	
	ls /usr/bin -al > log.$today

这样可以生成一个跟时间有关的变量名,这都是字符串连接吗

## 10.5 重定向输入和输出

### 10.5.1 输出重定向

`>` 符号来完成标准输出的重定向

`command > outputfile` command的输出会重定向到outputfile文件

`>>` 输出追加到文件,而不是覆盖

### 10.5.2 输入重定向

`<` 输入重定向

`command < inputfile` inputfile内容流向command命令

`wc` 对数据文本的计数

* 行数
* 词数
* 字节数

`<<`内联重定向,不是从文件而是从命令行得到输入

    command << marker
	data
	marker

`marker`表示输入的开始和结束,可以任意选择,但是必须是一致的

## 10.6 管道

将某个命令的输出作为另一个命令的输入,重定向可以搞个中间文件

`管道连接(piping)` 会方便的多

`command1 | command2` command1的输出输入到command2

    rpm -qa | sort | more
	
## 10.7 执行数学运算

### 10.7.1 expr命令

    `expr 1 + 5`

*** 
expr命令操作符
***

但是类似`*`等符号在shell中有其他用途,要用`\`转义

将数学算式的结果赋值给一个变量,要用`` ` ``来获取expr 命令的输出

### 10.7.2 使用方括号

`$[ operation]` 使用`$`和`[]`来引用表达式

而且不用担心`*`等的误解

但是bash shell的数学运算只支持整数运算

    z shell支持完成的浮点数操作
	
### 10.7.3 浮点解决方案

最常用的方法是使用bash内建计算器`bc`

#### 1. bc的基本用法

bc计算器能够识别

* 数字(整数和浮点数)
* 变量(简单变量和数组)
* 注释(以井号开头或者`/* */` 对)
* 表达式
* 编程语言(如if-then)
* 函数

这就是一门语言

`scale`内建变量,设置浮点数的小数点位数

`print`可以打印

#### 2. 在脚本中使用bc

    variable=`echo "options; expression" | bc`

通过`|`来传递参数,通过`` ` ``来引用输出

   var1=`echo " scale=4; 3.44/5" | bc`
  
用`;`来分隔输入的语句, 在语句中可以使用shell脚本的变量

但是有很多语句时,同时列出这么多语句会比较复杂,可以使用重定向,但是要单独写一个表达式的文件

最方便的是使用`内联重定向`

    variable=`bc << EOF
	
	options
	
	statements
	
	expressions
	
	EOF
	`
	
不要忘了使用`` ` `` 来引用命令的结果

在语句块里面还可以使用变量,但是变量是存在于bc中的,一旦退出,变量不能在shell脚本中使用

## 10.8 退出脚本

`退出状态码(exit status)`,0-225之间,告诉shell它完成了处理

### 10.8.1 查看退出状态码

`$?` 来查看退出状态码,最后一条命令的退出状态码

`echo $?` 显示退出状态码

### 10.8.2 exit命令

默认情况下脚本会以最后一条命令的退出状态码退出

`exit` 来改变退出状态码 `exit 5`

可以在`exit`命令参数中使用变量,但是退出码的返回0-255,超过这个范围会取256的模

