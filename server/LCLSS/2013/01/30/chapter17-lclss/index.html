<link href="/assets/themes/twitter/css/pygments.css" rel="stylesheet">

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>图形化桌面上的脚本编程 chapte17 LCLSS</title>
    <meta name="description" content="">
    <meta name="author" content="dogeyes">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">dogeyes</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h1>图形化桌面上的脚本编程 chapte17 LCLSS </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>30 January 2013</strong>
    </div>
    <div class="content">
      <h1>第17章 图形化桌面上的脚本编程</h1>

<h2>17.1 创建文本菜单</h2>

<h3>17.1.1 创建菜单布局</h3>

<p><code>clear</code> 命令用当前终端会话的terminfo数据来清理 出现在屏幕上的文本,接着用echo来显示菜单元素</p>

<p><code>echo</code>中显示制表符,换行符等,使用<code>-e</code>选项</p>

<pre><code>echo -e "1.\tDisplay disk space"
</code></pre>

<p>这样对排版来说大有好处</p>

<pre><code>clear
echo
echo -e "\t\t\tSys Admin Menu\n"
echo -e "\t1. Display disk space"
echo -e "\t2. Display logged on users"
echo -e "\t3. Display memory usage"
echo -e "\t0. Exit menu\n\n"
echo -en "\t\tEnter option: "
read -n 1 option
</code></pre>

<h3>17.1.2 创建菜单函数</h3>

<p><strong>桩函数(stub function)</strong>,用来占位</p>

<pre><code>function diskspace {
  clear
  echo "This is where the diskspace commands will go"
}
</code></pre>

<p>将菜单布局本身作为一个函数创建</p>

<pre><code>function menu {
    clear
    echo
    echo -e "\t\t\tSys Admin Menu\n"
    echo -e "\t1. Display disk space"
    echo -e "\t2. Display logged on users"
    echo -e "\t3. Display memory usage"
    echo -e "\t0. Exit menu\n\n"
    echo -en "\t\tEnter option: "
    read -n 1 option
}
</code></pre>

<h3>17.1.3 添加菜单逻辑</h3>

<p><code>case</code>命令</p>

<pre><code>menu
case $option in
0)
    break ;;
1)
    diskspace ;;
2) 
    whoseon ;;
3)
    memusage ;;
*)
    clear
    echo "Sorry, wrong selection" ;;
esac
</code></pre>

<h3>17.1.4 整合shell脚本菜单</h3>

<pre><code>function diskspace {
    clear
    df -k
}
function whoseon {
    clear
    who
}
function memusage {
    clear
    cat /proc/meminfo
}
function menu {
    clear
    echo
    echo -e "\t\t\tSys Admin Menu\n"
    echo -e "\t1. Display disk space"
    echo -e "\t2. Display logged on users"
    echo -e "\t3. Display memory usage"
    echo -e "\t0. Exit menu\n\n"
    echo -en "\t\tEnter option: "
    read -n 1 option
}

while [ 1 ]
do
    menu
    case $option in
    0)
        break ;;
    1)
        diskspace ;;
    2) 
        whoseon ;;
    3)
        memusage ;;
    *)
        clear
        echo "Sorry, wrong selection" ;;
    esac
    echo -en "\n\n\t\tHit and key to continue"
    read -n 1 line 
done    
clear
</code></pre>

<h3>17.1.5 使用select命令</h3>

<p><code>select</code>命令允许从单个命令行创建菜单,然后再提取输入的答案并自动处理</p>

<pre><code>select variable in list
do
    commands
done
</code></pre>

<p>list参数是构成菜单的空格分割的文本选项列表</p>

<p>select命令会在列表中将每个选项作为一个编好号的选项显示,然后为选项显示一个特殊的由PS3环境变量定义的提示符</p>

<pre><code>function diskspace {
    clear
    df -k
}
function whoseon {
    clear
    who
}
function memusage {
    clear
    cat /proc/meminfo
}

PS3="Enter option: "
select option in "Display disk space" "Display logged on users" "Display memory usage" "Exit program"
do
    case $option in
    "Exit program")
        break;;
    "Display disk space")
        diskspace;;
    "Display logged on users")
        whoseon;;
    "Display memory usage")
        memusage;;
    *)
        clear
        echo "Sorry, wrong selection";;
    esac
done
clear
</code></pre>

<h2>17.2 使用窗口</h2>

<p><code>dialog</code>包,能将文本环境总用ANSI转义控制字符来创建标准的窗口对话框</p>

<h3>17.3 dialog包</h3>

<p>部件(widget)</p>

<hr />

<p>dialog部件 p361</p>

<hr />

<p><code>dialog --widget parameters</code></p>

<p>parameters定义了部件的大小以及部件需要的文本</p>

<p>每个dialog部件提供了两种格式的输出</p>

<ul>
<li>使用STDERR</li>
<li>使用退出状态码</li>
</ul>


<p>退出状态码决定了用户选择的按钮,可以用<code>#?</code>来查看具体选择了哪个按钮</p>

<p>如果部件返回了任何数据,比如菜单选择, 那么dialog命令会将数据发送到STDERR,可以重定向之</p>

<pre><code>dialog --inputbox "Enter your age:" 10 20 2&gt;age.txt
</code></pre>

<h4>1. msgbox部件</h4>

<pre><code>dialog --msgbox text height width
</code></pre>

<p><code>--title</code> 顶部标题</p>

<pre><code>dialog --title testing --msgbox "This is a test" 10 20
</code></pre>

<h4>2. yesno部件</h4>

<pre><code>dialog --title "Please answer"  --yesno "Is this thing on?" 10 20

echo $?
</code></pre>

<h4>3.inputbox部件</h4>

<p>会将输入发送给STDERR</p>

<pre><code>dialog --inputbox "Enter your age" 10 20 2&gt;age.txt
echo $?
</code></pre>

<h4>4. textbox部件</h4>

<pre><code>dialog --textbox /etc/passwd 15 45
</code></pre>

<h4>5. menu部件</h4>

<pre><code>dialog --menu "Sys Admin Menu " 20 30 10 1 "Display disk space" 2 "Display users" 3 "Display memory usage" 4 "Exit" 2&gt; test.txt
</code></pre>

<h4>6. fselect部件</h4>

<pre><code>dialog --title "Select a file" --fselect $HOME/ 10 50 2&gt;file.txt
</code></pre>

<h3>17.2.2 dialog选项</h3>

<hr />

<p>dialog命令选项</p>

<hr />

<h3>17.2.3 在脚本中使用dialog命令</h3>

<ul>
<li>如果有Cancel或No按钮,检查dialog命令的退出状态码</li>
<li>重定向STDERR来获得输出值</li>
</ul>


<p>一个脚本</p>

<pre><code>temp=`mktemp -t test.XXXXXX`
temp=`mktemp -t test2.XXXXXX`

function diskspace {
    df -k &gt; $temp
    dialog --textbox $temp 20 60
}
function whoseon {
    who &gt; $temp
    dialog --textbox $temp 20 50
}
function memusage {
    cat /proc/meminfo
    dialog --textbox $temp 20 50
}
function menu {
    clear
    echo
    echo -e "\t\t\tSys Admin Menu\n"
    echo -e "\t1. Display disk space"
    echo -e "\t2. Display logged on users"
    echo -e "\t3. Display memory usage"
    echo -e "\t0. Exit menu\n\n"
    echo -en "\t\tEnter option: "
    read -n 1 option
}

while [ 1 ]
do
    dialog --menu "Sys Admin Menu " 20 30 10 1 "Display disk space" 2 "Display users" 3 "Display memory usage" 4 "Exit" 2&gt; temp2

    if [ $? -eq 1 ]
    then
        break
    fi

    selection=`cat $temp2`
    case $selection in
    0)
        break ;;
    1)
        diskspace ;;
    2) 
        whoseon ;;
    3)
        memusage ;;
    *)
        clear
        dialog --msgbox "Sorry, invalid selection" 10 30 ;;
    esac
    done
    rm -f $temp 2&gt; /dev/null
    rm -f $temp2 2&gt; /dev/null   
</code></pre>

<h2>17.3 使用图形</h2>

<p>kdialog 和 zenity包, 各自为KDE和GNOME桌面提供了图形化窗口部件</p>

<h3>17.3.1 KDE环境</h3>

<p>kdialog包</p>

<h4>1. kdialog部件</h4>

<p>和dialog包类似</p>

<pre><code>kdialog display-options window-options arguments
</code></pre>

<p><code>window-options</code>选项允许指定使用哪种类型的窗口部件</p>

<hr />

<p>kdialog窗口选项</p>

<hr />

<pre><code>kdialog --checklist "Item I need" 1 "Toothbrush" on 2 "Toothpaste" off 3 "Hair brush" on 4 "Deodorant" off 5 "lippers" off
</code></pre>

<p>默认发送到STDOUT</p>

<h4>2. 使用kdialog</h4>

<p>kdialog使用STDOUT输出,而dialog用STDERR输出</p>

<p>使用和dialog包几乎完全一样</p>

<h3>17.3.2 GNOME环境</h3>

<ul>
<li>gdialog</li>
<li>zenity</li>
</ul>


<h4>1. zenity部件</h4>

<hr />

<p>zenity窗口部件</p>

<hr />

<p>zenity命令行程序于dialog工作方式有些不同, 许多部件类型都用命令行上的其他选项定义,而不是将它们包括在选项参数里</p>

<p>将结果输出到STDOUT</p>

<h4>2. 在脚本总使用zenity</h4>

<pre><code>zenity --text-info --title "Logged in users" --filename=$temp --width 500 --height 500
</code></pre>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#LCLSS-ref">
    		LCLSS <span>23</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#LCLSS-ref">LCLSS <span>23</span></a></li>
     
    	<li><a href="/tags.html#linux-ref">linux <span>23</span></a></li>
     
    	<li><a href="/tags.html#学习-ref">学习 <span>34</span></a></li>
     
    	<li><a href="/tags.html#command line-ref">command line <span>22</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/LCLSS/2013/01/29/chapter16-lclss" title="创建函数 chapte16 LCLSS">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/LCLSS/2013/01/30/chapter18-lclss" title="初识sed和gawk chapte18 LCLSS">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>

      </div>
      <hr>
      <footer>
        <p>&copy; 2013 dogeyes
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    
  </body>
</html>

