<link href="/assets/themes/twitter/css/pygments.css" rel="stylesheet">

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>理解Linux文件权限 chapter6 LCLSS</title>
    <meta name="description" content="">
    <meta name="author" content="dogeyes">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">dogeyes</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h1>理解Linux文件权限 chapter6 LCLSS </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>19 December 2012</strong>
    </div>
    <div class="content">
      <h1>第6章 理解Linux文件权限</h1>

<h2>6.1 Linux的安全性</h2>

<p>Linux安全系统的核心是用户账户,每个进入Linux系统的用户都会被分配一个唯一的用户账户,用户对系统上对象的访问权限取决于他们登录系统时用的账户</p>

<p>用户权限是通过创建用户时分配的<strong>用户ID(User ID, UID)</strong>来跟踪的</p>

<p>每个用户都有唯一的UID,登录时不用UID登录,而用<strong>登录名(login name)</strong>,登录名关联一个对应的密码</p>

<h3>6.1.1 /etc/passwd文件</h3>

<p>文件管理登录名和UID的对应</p>

<p><strong>root</strong>是系统管理员,UID为0</p>

<p>linux会为各种各样的功能创建不同的用户账户,这些账户不是真正的用户,是<strong>系统账户</strong>,是系统上运行的各种服务进程访问资源用的特殊账户, 所有运行在后台的服务都需要一个系统用户账户登录到Linux系统.</p>

<p>Linux为系统账户预留了500一下的UID值,有些服务甚至要特定的UID才能正常工作.</p>

<p>为不同用户创建账户时,大多数Linux系统会将500起始的第一个可用UID分配给这个账户</p>

<p>/etc/passwd 包含</p>

<ul>
<li>登录用户名</li>
<li>用户密码</li>
<li>用户账户UID</li>
<li>用户账户GID</li>
<li>用户账户的文本描述</li>
<li>用户的HOME目录位置</li>
<li>用户的默认shell</li>
</ul>


<p>密码显示为x,现在的密码一般保存在另一个单独文件中(shadow文件,/etc/shadow),只有特定的程序才能访问这个文件</p>

<p>虽然/etc/passwd 可以直接编辑,但是最好不要,一旦损坏系统就无法读取他了,甚至连root也无法登陆了.</p>

<h3>6.1.2 /etc/shadow文件</h3>

<p>/etc/shadow 能对Linux系统如何管理密码有更多的控制,只有root可以访问</p>

<p>为系统上的每个用户账户保存了一条记录</p>

<pre><code>dexctor:$1$lUhhbcOL$udjVN09RCa3YVagoJgGt91:15567:0:99999:7:::
</code></pre>

<p>9个字段</p>

<ol>
<li>登录名</li>
<li>加密后的密码</li>
<li>自1970年1月1日(上次修改密码的日期)到当天的天数</li>
<li>多少天后才能修改密码</li>
<li>多少天后必须修改密码</li>
<li>密码过期前提前多少天提醒用户更换密码</li>
<li>密码过期后多少天禁用用户账户</li>
<li>用户账户被禁用的日期</li>
<li>预留字段,给将来使用</li>
</ol>


<h3>6.1.3 添加新用户</h3>

<p><code>useradd</code> 命令来添加新用户.</p>

<p>有可能在/usr/sbin/useradd,有可能不在PATH下.</p>

<p><code>useradd -D</code> 查看系统默认设置</p>

<pre><code>GROUP=100     //新用户添加到GID为100的组
HOME=/home    //HOME目录为/home/loginname
INACTIVE=-1   //密码过期后不会禁用
EXPIRE=       //未被设置为某个日期后过期
SHELL=/bin/sh //bash 作为默认shell
SKEL=/etc/skel //系统会将/etc/skel目录下的内容复制到HOME下
CREATE_MAIL_SPOOL=no //不创建mail目录
</code></pre>

<p>不在命令行制定,useradd会使用默认设置</p>

<p>倒数第二个配置,useradd允许管理员创建一份默认的HOME目录配置,然后把它作为创建新用户HOME目录的模板.</p>

<p>默认useradd不创建HOME目录,<code>-m</code>选项会叫他创建HOME目录</p>

<p>要想在创建用户时改变默认值或默认行为,可以使用命令行参数</p>

<hr />

<p>useradd命令行参数</p>

<hr />

<p>修改默认值<code>useradd -D 参数</code></p>

<pre><code>`useradd -D -s /bin/tsch` 默认shell改为tsch
</code></pre>

<h3>6.1.4 删除用户</h3>

<p><code>userdel</code> 删除用户</p>

<p>默认情况只是删除/ect/passwd文件总的用户信息,而不会删除属于该账户的任何文件</p>

<p><code>-r</code>参数,删除HOME和mail目录, 然而系统上仍然可能存在归已删除用户所有的文件,这有可能导致问题</p>

<h3>6.1.5 修改用户</h3>

<ul>
<li>usermod 修改用户账户字段,并可以指定主要组以及附加组的所属关系</li>
<li>passwd 改密码</li>
<li>chpasswd 从文件中读取登录名密码对,并更新密码</li>
<li>chage 修改密码的过期日期</li>
<li>chfn 修改用户账户的备注信息</li>
<li>chsh 修改默认shell</li>
</ul>


<h4>1 usermod</h4>

<p>可以修改/etc/passwd 中的大部分字段</p>

<p><code>-c</code> 修改备注字段</p>

<p><code>-e</code> 修改过期日期</p>

<p><code>-g</code> 修改默认登录组</p>

<p><code>-l</code> 修改用户账户的登录名</p>

<p><code>-L</code> 锁定用户账户, 这样用户就无法登录了</p>

<p><code>-p</code> 修改密码</p>

<p><code>-U</code> 解出锁定</p>

<h4>2 passwd和chpasswd</h4>

<p><code>passwd test</code> 修改test用户的密码</p>

<p>无参数是修改当前用户的密码</p>

<p><code>-e</code> 选项能强制用户下次登录时修改密码, 可以先给用户设置一个简单的密码,再让他下次登录时改成更复杂的密码</p>

<p>若要为系统中的大量用户来修改密码, chpasswd命令能让事情变简单,<code>chpasswd</code>能从标准输入读取登录名和密码对(冒号分割)列表,给密码加密.也可用重定向</p>

<h4>3 chsh, chfn 和 chage</h4>

<p><code>chsh</code> 修改默认的shell, 要用shell的完整路径</p>

<p><code>chfn</code> 提供了在/etc/passwd文件备注字段中存储信息的标准方法,<code>chfn</code>会将<code>finger</code>命令用到的信息存进备注字段.</p>

<p><code>finger</code> 可以简单的查看Linux系统的用户信息,但是处于安全性考虑,这个命令一般会被禁</p>

<p><code>chage</code> 命令帮助用户管理用户账户的有效期</p>

<ul>
<li>YYYY-MM-DD格式日期</li>
<li>从1970.1.1 到该日期的天数的数值</li>
</ul>


<p>用<code>chage</code>可以设定临时用户,到日期后就失效</p>

<h2>6.2 使用Linux组</h2>

<p><strong>组(Group)</strong> 在一组用户共享资源时使用有效</p>

<p>组权限允许多个用户共享一组共用的权限来访问系统上的对象,比如文件,目录,设备</p>

<p>每个组有一个唯一的GID,和唯一的组名</p>

<h3>6.2.1 /etc/group文件</h3>

<p>`/etc/group包含系统上的每个组的信息</p>

<p>系统账户的组通常会分配低于500的GID,而用户组从500开始分配</p>

<ul>
<li>组名</li>
<li>组密码</li>
<li>GID</li>
<li>属于该组的用户列表(要小心的是并不是所有用户都会列在这里,如果/etc/passwd文件中制定某个组作为默认组时,用户账户不会作为该组的成员再次出现在/etc/group文件中.)</li>
</ul>


<p>组密码允许非组内成员通过它临时性的称为该组成员,但这个功能不常用</p>

<p>不要直接修改/etc/group文件来添加用户到一个组,而要用usermod.</p>

<p>在添加用户到组之前,先要创建组</p>

<h3>6.2.2 创建新组</h3>

<p><code>groupadd</code> 创建新组</p>

<p>创建新组时,默认没有用户属于该组成员,groupadd没有提供将用户添加到组的选项,但是可以用<code>usermod</code>命令将用户添加到组</p>

<p><code>usermod -G test dexctor</code> 将dexctor,添加到test</p>

<p>如果更改已登录系统账户的所属用户组,重新登录后,组关系才会生效</p>

<p>将组添加到用户账户要格外小心,如果加了<code>-g</code>参数,那么默认组将被替换,而<code>-G</code>将该组添加到用户的属组列表,不会影响默认组</p>

<h3>6.2.3 修改组</h3>

<p><code>groupmod</code> 修改已有组的GID<code>-g</code>参数,或组名<code>-n</code>参数</p>

<p>修改组名,GID和成员不变,只有组名改变,所有安全权限都是基于GID的,可以随意修改组名而不会影响文件的安全性(<em>那么修改GID呢?</em>)</p>

<h2>6.3 理解文件权限</h2>

<h3>6.3.1 使用文件权限符</h3>

<p><code>ls -l</code> 第一个字段是描述文件和目录权限的码</p>

<ul>
<li><code>-</code> 代表文件</li>
<li><code>d</code> 代表目录</li>
<li><code>l</code> 代表链接</li>
<li><code>c</code> 代表字符型设备</li>
<li><code>b</code> 代表块设备</li>
<li><p><code>n</code> 代表网络设备</p></li>
<li><p><code>r</code> 代表对象是可读的</p></li>
<li><code>w</code> 代表对象是可写的</li>
<li><code>x</code> 代表对象是可执行的</li>
</ul>


<p>没有某种权限,会出现单破折号</p>

<p>三组三字码分别对应对象的3个安全级别</p>

<ul>
<li>对象的属主</li>
<li>对象的属组</li>
<li><p>系统其他用户</p>

<p>  -rwxrwxr-x 1 rich rich 4882 2010-09-18 13:58 myprog</p></li>
<li><p>rwx: 文件的属主(设为登录名rich)</p></li>
<li>rwx: 文件的属组(设为组名rich)</li>
<li>r-x: 系统其他人</li>
</ul>


<p>rich用户可读可写可执行文件,rich组用户可读可写可执行文件,其他可读可执行</p>

<h3>6.3.2 默认文件权限</h3>

<p><code>umask</code> 设置用户创建文件和目录的默认权限</p>

<p><code>umask</code> 可以显示和设置这个默认权限</p>

<pre><code>umake
0022
</code></pre>

<p>第一位代表了一项特别的安全特性,叫做<strong>粘着位(sticky bit)</strong></p>

<p>后面三位表示文件或目录umask的八进制值.</p>

<p>但是为什么新建文件的权限是644呢?</p>

<p>umask值只是个掩码,它会屏蔽掉不想授予该安全级别的权限,umask值会从对象的全权限中减掉,对文件来说全权限是666,对目录来说全权限是77</p>

<p>umask通常设定在/etc/profile启动文件中,也可通过umask命令设置</p>

<p><code>umask 026</code>  将umask设定为026</p>

<h2>6.4 改变安全性设置</h2>

<h3>6.4.1 改变权限</h3>

<p><code>chmod options mode file</code> 改变文件和目录的安全性设置</p>

<p>mode参数后可跟八进制模式或符号模式来设置安全性设置</p>

<pre><code>chmod 760 newfile
</code></pre>

<p>将newfile权限改为760</p>

<p>符号权限就比较麻烦了</p>

<p><code>[ugoa...][[+-=][rwxXstugo...]</code></p>

<ul>
<li>u 代表用户</li>
<li>g 代表组</li>
<li>o 代表其他</li>
<li><p>a 代表所有</p></li>
<li><ul>
<li>增加权限</li>
</ul>
</li>
<li><ul>
<li>移除权限</li>
</ul>
</li>
<li><p>= 设定权限</p></li>
<li><p>X 如果对象是目录或者它已有执行权限,赋予执行权限</p></li>
<li>s 运行时重设UID或GID <strong>重要</strong></li>
<li>t 保留问及或目录</li>
<li>u 将权限设置为跟属主一样</li>
<li>g 将权限设置为跟属组一样</li>
<li><p>o 将权限设置为跟其他用户一样</p>

<p>  chmod o+r newfile  other增加读权限</p>

<p>  chmod u-r newfile  user移除读权限</p></li>
</ul>


<p><code>options</code> 参数为chmod命令提供额外的功能, <code>-R</code>参数可以让权限的改变递归的作用到文件和子目录</p>

<h3>6.4.2 改变所属关系</h3>

<p><code>chown</code> 改变属主</p>

<p><code>chgrp</code> 改变默认属组</p>

<p><code>chown options owner[.group] file</code></p>

<p>chown也同时支持改变文件属组,加.group</p>

<p><code>chown .rich newfile</code> 改变目录的默认属组</p>

<p><code>chown rich. newfile</code> 改变目录属主和属组为rich</p>

<p><code>-R</code> 递归改变子目录和文件</p>

<p><code>-h</code>参数改变该文件所有符号链接文件的所属关系</p>

<p>只有root能改属主, 属主可以改属组,但是属主必须属于源和目标属组</p>

<p><code>chgrp group file</code> 改变属组</p>

<h2>6.5 共享文件</h2>

<p>创建组是Linux系统上共享文件访问权限的方法</p>

<p>改变文件的属组,或者将用户加到文件属组, 不一定,还有更好的方法</p>

<ul>
<li>设置用户ID(SUID) 当文件被用户使用时,程序会以文件属主的权限运行</li>
<li>设置组ID(SGID) 对文件来说,程序会以文件属组的权限运行,对目录来说,目录创建的新文件会以目录的默认属主作为默认属主</li>
<li>粘着位, 进程结束后文件还会在内存中</li>
</ul>


<p><strong>SGID</strong> 对文件共享非常重要,使能SGID位, 在共享目录下创建的新文件属于该目录的属组,也就是每个用户的组</p>

<p>SGID 通过chmod命令设置,加到标准3位8进制之前(组成4位8进制),或者在符号模式下使用符号s</p>

<p>  1    2     3
SUID SGID 粘着位</p>

<p>共享文件</p>

<ol>
<li>创建共享目录</li>
<li>chgrp 默认属组改为含有所有所需共享文件用户的组</li>
<li>设置目录的SGID 为,新建文件以共享组为属组</li>
</ol>


<p>为了能正常工作,要把umask设为属组可写</p>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#LCLSS-ref">
    		LCLSS <span>23</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#LCLSS-ref">LCLSS <span>23</span></a></li>
     
    	<li><a href="/tags.html#linux-ref">linux <span>23</span></a></li>
     
    	<li><a href="/tags.html#command line-ref">command line <span>22</span></a></li>
     
    	<li><a href="/tags.html#学习-ref">学习 <span>34</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/LCLSS/2012/12/19/chapter5-lclss" title="使用linux环境变量 chapter5 LCLSS">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/LCLSS/2012/12/21/chapter7-lclss" title="管理文件系统 chapter7 LCLSS">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>

      </div>
      <hr>
      <footer>
        <p>&copy; 2013 dogeyes
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    
  </body>
</html>

